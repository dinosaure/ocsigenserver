OASISFormat:		0.4
Name:			ocsigenserver
Version:		0.1
Synopsis:		HTTP Server in OCaml
Authors:		Vincent Balat
License:		MIT
Plugins:		META (0.3), DevFiles (0.3)
BuildTools:		ocamlbuild
OCamlVersion:		>= 4.01
BetaFeatures:		section_object

Flag camlzip
  Description:		Build with CamlZip library
  Default:		false

Flag preemptive
  Description:		Build with Lwt Preemptive library
  Default:		false

Flag commandline
  Description:         Parse command line
  Default:             true

Library ocsigenserver
  Path:			src/
  Pack:			true

Library polytables
  Path:			src/polytables
  FindlibParent:	ocsigenserver
  Modules:		Polytables

Library commandline
  Path:                src/commandline/yes
  FindlibParent:       ocsigenserver
  Modules:             Ocsigen_getcommandline
  Build$:              flag(commandline)

Library nocommandline
  Path:                src/commandline/no
  FindlibParent:       ocsigenserver
  Modules:             Ocsigen_getcommandline
  Build$:              !flag(commandline)

Library baselib
  Path:			src/baselib
  FindlibParent:	ocsigenserver
  Modules:		Ocsigen_cache,
                        Ocsigen_commandline,
                        Ocsigen_config,
                        Ocsigen_lib,
                        Ocsigen_lib_base,
                        Ocsigen_loader,
                        Ocsigen_messages,
                        Ocsigen_stream,
                        Dynlink_wrapper
  BuildDepends:		lwt,
                        lwt.unix,
                        lwt.syntax,
                        optcomp,
                        netstring,
                        netstring-pcre,
                        cryptokit,
                        findlib,
                        dynlink

Object base
  Path:			src/baselib
  FindlibFullName:	ocsigenserver.baselib.base
  Modules:		Ocsigen_lib_base
  BuildDepends:		lwt

Library http
  Path:			src/http
  FindlibParent:	ocsigenserver
  Modules:		Ocsigen_cookies,
                        Ocsigen_http_frame,
                        Ocsigen_headers,
                        Ocsigen_http_com,
                        Ocsigen_charset_mime,
                        Ocsigen_senders
  InternalModules:	Multipart,
                        Http_lexer,
                        Http_headers,
                        Framepp
  BuildDepends:		ocsigenserver.baselib,
                        tyxml,
                        lwt.ssl,
                        ipaddr

Object cookies
  Path:			src/http
  Modules:		Ocsigen_cookies
  FindlibFullName:	ocsigenserver.cookies

Library server
  Path:			src/server
  FindlibParent:	ocsigenserver
  Modules:		Ocsigen_extensions,
                        Ocsigen_range,
                        Ocsigen_parseconfig,
                        Ocsigen_http_client,
                        Ocsigen_local_files,
                        Ocsigen_server
  BuildDepends:		ocsigenserver.polytables,
                        ocsigenserver.baselib,
                        ocsigenserver.http,
                        tyxml.parser

# EXTENSIONS

Library ext
  Path:			src/extensions/
  FindlibParent:	ocsigenserver

Library staticmod
  Path:			src/extensions/staticmod
  Modules:		Staticmod
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library accesscontrol
  Path:			src/extensions/accesscontrol
  Modules:		Accesscontrol
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library authbasic
  Path:			src/extensions/authbasic
  Modules:		Authbasic
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library cgimod
  Path:			src/extensions/cgimod
  Modules:		Cgimod
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library cors
  Path:			src/extensions/cors
  Modules:		Cors
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library deflatemod
  Build$:		flag(camlzip)
  Install$:		flag(camlzip)
  Path:			src/extensions/deflatemod
  Modules:		Deflatemod
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server, camlzip

Library extendconfiguration
  Path:			src/extensions/extendconfiguration
  Modules:		Extendconfiguration
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library extensiontemplate
  Path:			src/extensions/extensiontemplate
  Modules:		Extensiontemplate
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library ocsigen_comet
  Path:			src/extensions/ocsigen_comet
  Modules:		Ocsigen_comet
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server, react

Library outputfilter
  Path:			src/extensions/outputfilter
  Modules:		Outputfilter
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library redirectmod
  Path:			src/extensions/redirectmod
  Modules:		Redirectmod
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library revproxy
  Path:			src/extensions/revproxy
  Modules:		Revproxy
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library rewritemod
  Path:			src/extensions/rewritemod
  Modules:		Rewritemod
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Library userconf
  Path:			src/extensions/userconf
  Modules:		Userconf
  FindlibParent:	ext
  BuildDepends:		ocsigenserver.server

Executable "ocsigenserver.opt"
  Path:			bin/
  MainIs:		server_main.ml
  CompiledObject:	native
  BuildDepends:		ocsigenserver.server

Executable ocsigenserver
  Path:			bin/
  MainIs:		server_main.ml
  CompiledObject:	byte
  BuildDepends:		ocsigenserver.server

Document ocsigenserver
  Type:			ocamlbuild (0.4)
  BuildTools:		ocamldoc
  Title:		ocsigenserver
  XOCamlbuildPath:      .
  XOCamlbuildLibraries: ocsigenserver.server
